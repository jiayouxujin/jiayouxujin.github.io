<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/9.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/9.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Java," />










<meta name="description" content="本文目录如下 [toc] 内存模型 Understanding Java Memory Model Understanding JVM Architecture Java Memory Model Java虚拟机原理：JVM为什么被称为机器（machine） 线程栈每个线程一个存放局部变量，引用对象的地址。 堆堆只有一个，堆里面存放着引用对象。所有线程new的对象都在堆里分配内存，然后在自己的线程">
<meta property="og:type" content="article">
<meta property="og:title" content="这一次重新学习Java">
<meta property="og:url" content="http://blog.xuxiaojin.com/3681760259.html">
<meta property="og:site_name" content="徐小晋的博客">
<meta property="og:description" content="本文目录如下 [toc] 内存模型 Understanding Java Memory Model Understanding JVM Architecture Java Memory Model Java虚拟机原理：JVM为什么被称为机器（machine） 线程栈每个线程一个存放局部变量，引用对象的地址。 堆堆只有一个，堆里面存放着引用对象。所有线程new的对象都在堆里分配内存，然后在自己的线程">
<meta property="og:image" content="http://cdn.xuxiaojin.com/202007242210_2.png">
<meta property="og:image" content="http://cdn.xuxiaojin.com/202007242252_22.png">
<meta property="og:image" content="http://cdn.xuxiaojin.com/202007251634_829.png">
<meta property="og:image" content="http://cdn.xuxiaojin.com/202007252013_976.png">
<meta property="og:image" content="http://cdn.xuxiaojin.com/202007252039_336.png">
<meta property="og:image" content="http://cdn.xuxiaojin.com/202007291534_845.png">
<meta property="og:image" content="http://cdn.xuxiaojin.com/202007291557_154.png">
<meta property="og:image" content="http://cdn.xuxiaojin.com/202007281507_796.png">
<meta property="article:published_time" content="2020-07-21T16:00:00.000Z">
<meta property="article:modified_time" content="2020-08-10T14:12:29.771Z">
<meta property="article:author" content="徐晋">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://cdn.xuxiaojin.com/202007242210_2.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blog.xuxiaojin.com/3681760259.html"/>





  <title>这一次重新学习Java | 徐小晋的博客</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?91c59f68cca0da6fa05cfcb52fe0b3e8";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




<meta name="generator" content="Hexo 4.2.0"></head>


<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">徐小晋的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">学习成长与思考</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.xuxiaojin.com/3681760259.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="徐晋">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/author.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="徐小晋的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">这一次重新学习Java</h1>
        

        <div class="post-meta">
                  
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-07-22T00:00:00+08:00">
                2020-07-22
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2020-08-10T22:12:29+08:00">
                2020-08-10
              </time>
            

          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/3681760259.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/3681760259.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  7.3k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  31
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><strong>本文目录如下</strong></p>
<p>[toc]</p>
<h1 id="内存模型"><a href="#内存模型" class="headerlink" title="内存模型"></a>内存模型</h1><p><img src="http://cdn.xuxiaojin.com/202007242210_2.png" alt=""></p>
<p><a href="https://medium.com/platform-engineer/understanding-java-memory-model-1d0863f6d973" target="_blank" rel="noopener">Understanding Java Memory Model</a></p>
<p><a href="https://medium.com/platform-engineer/understanding-jvm-architecture-22c0ddf09722" target="_blank" rel="noopener">Understanding JVM Architecture</a></p>
<p><a href="http://tutorials.jenkov.com/java-concurrency/java-memory-model.html" target="_blank" rel="noopener">Java Memory Model</a></p>
<p><a href="https://time.geekbang.org/column/article/168945" target="_blank" rel="noopener">Java虚拟机原理：JVM为什么被称为机器（machine）</a></p>
<h2 id="线程栈"><a href="#线程栈" class="headerlink" title="线程栈"></a>线程栈</h2><p>每个线程一个存放局部变量，引用对象的地址。</p>
<h2 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h2><p>堆只有一个，堆里面存放着引用对象。所有线程new的对象都在堆里分配内存，然后在自己的线程栈里存放对象的引用。</p>
<h2 id="方法区"><a href="#方法区" class="headerlink" title="方法区"></a>方法区</h2><p>方法区也只有一个，用来存放编译后的代码</p>
<h1 id="关键词"><a href="#关键词" class="headerlink" title="关键词"></a>关键词</h1><h2 id="final"><a href="#final" class="headerlink" title="final"></a>final</h2><p><a href="[https://en.wikipedia.org/wiki/Final_(Java)#:~:text=In%20the%20Java%20programming%20language,always%20contains%20the%20same%20value.](https://en.wikipedia.org/wiki/Final_(Java">wiki final keyword</a>#:~:text=In the Java programming language,always contains the same value.)</p>
<blockquote>
<p>In the Java programming language, the <code>final</code> keyword is used in several contexts to define an entity that can only be assigned once.</p>
</blockquote>
<h3 id="数据"><a href="#数据" class="headerlink" title="数据"></a>数据</h3><p>声明数据为final，即在运行的过程中不能改变值。如果是基本类型，那么数值不变。如果是引用类型，那么不能在引用新的对象，但是被引用的对象本身可以修改。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FinalKeyWord</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] array=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">4</span>];</span><br><span class="line">        array[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span>[] finalArray=array;</span><br><span class="line">        System.out.println(array[<span class="number">1</span>]);  <span class="comment">//1</span></span><br><span class="line">        System.out.println(finalArray[<span class="number">1</span>]); <span class="comment">//1</span></span><br><span class="line">        array[<span class="number">1</span>]=<span class="number">2</span>;</span><br><span class="line">        System.out.println(array[<span class="number">1</span>]);  <span class="comment">//2</span></span><br><span class="line">        System.out.println(finalArray[<span class="number">1</span>]); <span class="comment">//2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p>如果方法声明为final，那么不能被子类重写。如果之类存在和final声明的方法一样的签名，则相当于定义了一个新的方法。</p>
<p>[java 方法签名]([<a href="https://www.thoughtco.com/method-signature-2034235#:~:text=In%20Java%2C%20a%20method%20signature,name%20but%20accept%20different%20parameters.]" target="_blank" rel="noopener">https://www.thoughtco.com/method-signature-2034235#:~:text=In%20Java%2C%20a%20method%20signature,name%20but%20accept%20different%20parameters.]</a>(<a href="https://www.thoughtco.com/method-signature-2034235#:~:text=In" target="_blank" rel="noopener">https://www.thoughtco.com/method-signature-2034235#:~:text=In</a> Java%2C a method signature,name but accept different parameters.))</p>
<blockquote>
<p>In Java, a method signature is part of the method declaration. It’s the combination of the method name and the parameter list.</p>
</blockquote>
<h3 id="类"><a href="#类" class="headerlink" title="类"></a>类</h3><p>如果类声明为final，那么这个类不能被继承。</p>
<h3 id="final解决并发问题"><a href="#final解决并发问题" class="headerlink" title="final解决并发问题"></a>final解决并发问题</h3><p>[final keyword thread safe]([<a href="https://www.javamex.com/tutorials/synchronization_final.shtml#:~:text=Thread%2Dsafety%20with%20the%20Java%20final%20keyword&amp;text=Essentially%2C%20final%20can%20be%20used,state%2C%20as%20could%20otherwise%20happen.]" target="_blank" rel="noopener">https://www.javamex.com/tutorials/synchronization_final.shtml#:~:text=Thread%2Dsafety%20with%20the%20Java%20final%20keyword&amp;text=Essentially%2C%20final%20can%20be%20used,state%2C%20as%20could%20otherwise%20happen.]</a>(<a href="https://www.javamex.com/tutorials/synchronization_final.shtml#:~:text=Thread-safety" target="_blank" rel="noopener">https://www.javamex.com/tutorials/synchronization_final.shtml#:~:text=Thread-safety</a> with the Java final keyword&amp;text=Essentially%2C final can be used,state%2C as could otherwise happen.))</p>
<p>final域表示一个不可变对象，对于不可变的对象，在多线程访问的时候不存在线程安全问题。因为线程安全都是在访问可变的对象发生的。</p>
<h1 id="String"><a href="#String" class="headerlink" title="String"></a>String</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>首先在Java中String是不可变的，即String这个类是由final修饰的。</p>
<p><a href="[https://www.baeldung.com/java-string-interview-questions#:~:text=In%20Java%2C%20a%20String%20is,16%20bits%20(char%20size">Java String Interview Questions and Answers</a>.](<a href="https://www.baeldung.com/java-string-interview-questions#:~:text=In" target="_blank" rel="noopener">https://www.baeldung.com/java-string-interview-questions#:~:text=In</a> Java%2C a String is,16 bits (char size).)</p>
<h2 id="不可变"><a href="#不可变" class="headerlink" title="不可变"></a>不可变</h2><ol>
<li>由于String的不可变使得<code>String Pool</code>成为可能，因为一旦创建就不会发生改变，这样就可以复用。</li>
<li>参数安全，在方法间传递参数，由于不可变不会发生改变。</li>
<li>线程安全，因为不可变所以在操作的时候不需要加上<code>synchronize</code>能够很好的提升性能。如果一个线程改变了字符串，其实是新建一个字符串，而不是在原有字符串上更改。</li>
<li>hashcode可以缓存</li>
</ol>
<h3 id="不可变的对象"><a href="#不可变的对象" class="headerlink" title="不可变的对象"></a>不可变的对象</h3><p><a href="https://www.baeldung.com/java-immutable-object" target="_blank" rel="noopener">java immutable object</a></p>
<blockquote>
<p>An immutable object is an <strong>object whose internal state remains constant after it has been entirely created</strong>.</p>
</blockquote>
<p>不可对象可以用<code>get</code>，<code>set</code>函数来实现。</p>
<h2 id="String-Pool"><a href="#String-Pool" class="headerlink" title="String Pool"></a>String Pool</h2><p><a href="https://www.baeldung.com/java-string-pool" target="_blank" rel="noopener">String Pool</a></p>
<p>String Pool用来提供性能，因为String是不可变的，所以可以把String存起来复用，减少内存空间的消耗。</p>
<p><code>String str=&quot;abc&quot;</code>会先在字符串常量池里找是否存在abc的字符串，如果存在那么直接返回地址。不在的话会创建一个abc的字符并且放到字符串常量池。</p>
<h2 id="intern"><a href="#intern" class="headerlink" title="intern()"></a>intern()</h2><p>当调用<code>intern()</code>时，如果字符串常量池中存在与该字符值相同equal，那么直接返回该值的引用。如果不存在，则新创建一个，然后在返回该值的引用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String constantString = <span class="string">"interned Baeldung"</span>;</span><br><span class="line">        String newString = <span class="keyword">new</span> String(<span class="string">"interned Baeldung"</span>);</span><br><span class="line"></span><br><span class="line">         System.out.println(constantString==newString); <span class="comment">//false</span></span><br><span class="line"></span><br><span class="line">        String internedString = newString.intern();</span><br><span class="line">        System.out.println(constantString==internedString);  <span class="comment">//true</span></span><br><span class="line">        System.out.println(internedString==newString);  <span class="comment">//false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://cdn.xuxiaojin.com/202007242252_22.png" alt=""></p>
<h2 id="new-String-“abc”"><a href="#new-String-“abc”" class="headerlink" title="new String(“abc”)"></a>new String(“abc”)</h2><p><a href="https://stackoverflow.com/questions/19672427/string-s-new-stringxyz-how-many-objects-has-been-made-after-this-line-of" target="_blank" rel="noopener">stackoverflow</a></p>
<p>如果在字符串常量池中没有abc，那么该语句会创建<code>两个对象</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String2</span><span class="params">(String original)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = original.value;</span><br><span class="line">        <span class="keyword">this</span>.hash = original.hash;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过上面代码可以看到，abc会被先创建在字符串常量池中，然后在创建一个对象在堆中，并且指向的对象是在堆中，字符串常量池中的abc是多创建出来的对象。</p>
<h2 id="String-StringBuffer-StringBuilder"><a href="#String-StringBuffer-StringBuilder" class="headerlink" title="String StringBuffer StringBuilder"></a>String StringBuffer StringBuilder</h2><p><a href="https://stackoverflow.com/questions/2971315/string-stringbuffer-and-stringbuilder" target="_blank" rel="noopener">stackoverflow</a></p>
<h3 id="可变"><a href="#可变" class="headerlink" title="可变"></a>可变</h3><p>String 不可变</p>
<p>StringBuilder StringBuffer 可变</p>
<h3 id="线程安全"><a href="#线程安全" class="headerlink" title="线程安全"></a>线程安全</h3><p>String StringBuffer线程安全</p>
<p>StringBuilder线程不安全</p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>如果是肯定不会变的使用String，如果会变并且只有单线程那么使用StringBuilder，否则使用StringBuffer</p>
<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><h2 id="参数传递"><a href="#参数传递" class="headerlink" title="参数传递"></a>参数传递</h2><p><a href="https://stackoverflow.com/questions/40480/is-java-pass-by-reference-or-pass-by-value" target="_blank" rel="noopener">stackoverflow</a></p>
<p>Java中都是<code>传值</code>不存在传引用。</p>
<p>如果是基本类型，那么形参是值的复制品</p>
<p>如果是引用类型，那么形参是引用类型的地址，如果在函数中形参修改了引用对象的内在状态，那么函数外的状态也会发生改变，因为他们指向的是同一个地址。如果形参改变了指向的对象，那么就不会影响函数外对象的状态。</p>
<h1 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h1><p><img src="http://cdn.xuxiaojin.com/202007251634_829.png" alt=""></p>
<h2 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h2><blockquote>
<p>HashSet is Implemented using a hash table. Elements are not ordered. The add, remove, and contains methods has constant time complexity O(1). TreeSet is implemented using a tree structure(red-black tree in algorithm book). The elements in a set are sorted, but the add, remove, and contains methods has  time complexity of O(log (n)). It offers several methods to deal with the ordered set like first(), last(), headSet(), tailSet(), etc. LinkedHashSet is between HashSet and TreeSet. It is implemented as a hash table with a linked list running through it, so it provides the order of insertion. The time complexity of basic methods is O(1).  </p>
</blockquote>
<p><a href="https://dzone.com/articles/hashset-vs-treeset-vs" target="_blank" rel="noopener">HashSet vs. TreeSet vs. LinkedHashSet</a></p>
<h3 id="TreeSet"><a href="#TreeSet" class="headerlink" title="TreeSet"></a>TreeSet</h3><p><a href="https://www.baeldung.com/java-tree-set" target="_blank" rel="noopener">A Guide to TreeSet in Java</a></p>
<p><code>TreeSet</code>底层是基于<a href="https://www.youtube.com/watch?v=qvZGUFHWChY" target="_blank" rel="noopener">红黑树</a>实现的，其性能相对于<code>HashSet</code>是比较差的，<code>add</code>和<code>remove</code>操作都需要O(logn)的时间复杂度。但是支持有序操作，例如某个范围内查找元素的操作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeSetDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        TreeSet&lt;Integer&gt; treeSet=<span class="keyword">new</span> TreeSet&lt;&gt;();</span><br><span class="line">        treeSet.add(<span class="number">2</span>);</span><br><span class="line">        treeSet.add(<span class="number">1</span>);</span><br><span class="line">        treeSet.add(<span class="number">3</span>);</span><br><span class="line">        treeSet.add(<span class="number">6</span>);</span><br><span class="line">        treeSet.add(<span class="number">4</span>);</span><br><span class="line">        treeSet.add(<span class="number">5</span>);</span><br><span class="line">        <span class="comment">//不保证插入的顺序</span></span><br><span class="line">        <span class="comment">//1 2 3 4 5 6</span></span><br><span class="line">        treeSet.forEach(c-&gt;System.out.println(c));</span><br><span class="line">      </span><br><span class="line">        <span class="comment">//higher表示比3大的第一个元素</span></span><br><span class="line">        <span class="comment">// 4</span></span><br><span class="line">        System.out.println(treeSet.higher(<span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//lower表示比3小的第一个元素</span></span><br><span class="line">        <span class="comment">// 2</span></span><br><span class="line">        System.out.println(treeSet.lower(<span class="number">3</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="HashSet"><a href="#HashSet" class="headerlink" title="HashSet"></a>HashSet</h3><p><a href="https://www.baeldung.com/java-hashset" target="_blank" rel="noopener">A Guide to HashSet in Java</a></p>
<p><code>HashSet</code>底层是HashMap实现的，不保证插入的顺序，也就是插入的顺序和遍历的顺序是不确定的。并且不是线程安全的。同时整体的性能是有初始容量和装载因子决定。查找的时间复杂度是O(1)。</p>
<h3 id="LinkedHashSet"><a href="#LinkedHashSet" class="headerlink" title="LinkedHashSet"></a>LinkedHashSet</h3><p><code>LinkedHashSet</code>底层是双向链表和哈希表实现的，保证插入顺序，通过iter遍历得到的顺序与插入的顺序一致。同时查找的时间复杂度与HashSet一样是O(1)。</p>
<h2 id="List"><a href="#List" class="headerlink" title="List"></a>List</h2><h3 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a>ArrayList</h3><p><a href="https://www.javatpoint.com/java-arraylist" target="_blank" rel="noopener">Java ArrayList</a></p>
<p><code>ArrayList</code>基于动态数组来存储数据，没有长度限制，比较灵活和扩展。并且支持随机访问。不是线程安全的。</p>
<h3 id="Vector"><a href="#Vector" class="headerlink" title="Vector"></a>Vector</h3><p>与ArrayList类似，但是是线程安全的。</p>
<h3 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h3><p>底层是双向链表实现的，只能顺序访问，不支持随机访问，但是插入和删除的效率比ArrayList高【<a href="https://time.geekbang.org/column/article/216778" target="_blank" rel="noopener">这个描述其实不太对</a>】我们可以使用它来实现<a href="https://stackoverflow.com/questions/38591371/java-linkedlist-class-as-stack-and-queues" target="_blank" rel="noopener">栈、队列、双向队列</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StackDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        LinkedList&lt;Integer&gt; stack=<span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">        <span class="comment">//FILO</span></span><br><span class="line">        stack.add(<span class="number">1</span>);</span><br><span class="line">        stack.add(<span class="number">2</span>);</span><br><span class="line">        System.out.println(stack.removeLast());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h2><h3 id="LinkedList-1"><a href="#LinkedList-1" class="headerlink" title="LinkedList"></a>LinkedList</h3><p>可以用LinkedList实现双向队列</p>
<h3 id="PriorityQueue"><a href="#PriorityQueue" class="headerlink" title="PriorityQueue"></a>PriorityQueue</h3><p>用PriorityQueue实现优先队列，底层是由推结构实现的</p>
<h1 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h1><blockquote>
<p>A map is a key-value mapping, which means that every key is mapped to exactly one value and that we can use the key to retrieve the corresponding value from a map.</p>
</blockquote>
<h2 id="TreeMap"><a href="#TreeMap" class="headerlink" title="TreeMap"></a>TreeMap</h2><p>TreeMap基于红黑树来实现的Map</p>
<h2 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h2><p><a href="https://www.baeldung.com/java-hashmap" target="_blank" rel="noopener">A Guide to Java HashMap</a></p>
<p>HashMap基于哈希表来实现Map。如果要查找某个Key是否存在，时间复杂度为O(1)，如果要查找某个Value是否存在，时间复杂度为O(n)，因为需要遍历所有数据。</p>
<h3 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h3><p><a href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=59#/detail/pc?id=1762" target="_blank" rel="noopener">HashMap 底层实现原理是什么？JDK8 做了哪些优化？</a></p>
<p><a href="https://programmer.help/blogs/jdk1.8-hashmap-source-code-analysis.html" target="_blank" rel="noopener">JDK1.8 HashMap Source Code Analysis</a></p>
<p>在JDK1.7中HashMap是以数组和链表组成，在JDK1.8之后增加了红黑树，当链表长度为8并且容量大于等于64的时候，链表结构会变成红黑树。</p>
<p><img src="http://cdn.xuxiaojin.com/202007252013_976.png" alt=""></p>
<h4 id="put"><a href="#put" class="headerlink" title="put"></a>put</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 对 key 进行哈希操作</span></span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">               <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">    <span class="comment">// 哈希表为空则创建表</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        n = (tab = resize()).length;</span><br><span class="line">    <span class="comment">// 根据 key 的哈希值计算出要插入的数组索引 i</span></span><br><span class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</span><br><span class="line">        <span class="comment">// 如果 table[i] 等于 null，则直接插入</span></span><br><span class="line">        tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        Node&lt;K,V&gt; e; K k;</span><br><span class="line">        <span class="comment">// 如果 key 已经存在了，直接覆盖 value</span></span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">            ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            e = p;</span><br><span class="line">        <span class="comment">// 如果 key 不存在，判断是否为红黑树</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">            <span class="comment">// 红黑树直接插入键值对</span></span><br><span class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 为链表结构，循环准备插入</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                <span class="comment">// 下一个元素为空时</span></span><br><span class="line">                <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                    <span class="comment">// 转换为红黑树进行处理</span></span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                        treeifyBin(tab, hash);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//  key 已经存在直接覆盖 value</span></span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                p = e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">            V oldValue = e.value;</span><br><span class="line">            <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                e.value = value;</span><br><span class="line">            afterNodeAccess(e);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ++modCount;</span><br><span class="line">    <span class="comment">// 超过最大容量，扩容</span></span><br><span class="line">    <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">        resize();</span><br><span class="line">    afterNodeInsertion(evict);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://cdn.xuxiaojin.com/202007252039_336.png" alt=""></p>
<h4 id="resize"><a href="#resize" class="headerlink" title="resize"></a>resize</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;</span><br><span class="line">    <span class="comment">// 扩容前的数组</span></span><br><span class="line">    Node&lt;K,V&gt;[] oldTab = table;</span><br><span class="line">    <span class="comment">// 扩容前的数组的大小和阈值</span></span><br><span class="line">    <span class="keyword">int</span> oldCap = (oldTab == <span class="keyword">null</span>) ? <span class="number">0</span> : oldTab.length;</span><br><span class="line">    <span class="keyword">int</span> oldThr = threshold;</span><br><span class="line">    <span class="comment">// 预定义新数组的大小和阈值</span></span><br><span class="line">    <span class="keyword">int</span> newCap, newThr = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 超过最大值就不再扩容了</span></span><br><span class="line">        <span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class="line">            threshold = Integer.MAX_VALUE;</span><br><span class="line">            <span class="keyword">return</span> oldTab;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 扩大容量为当前容量的两倍，但不能超过 MAXIMUM_CAPACITY</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class="line">                 oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class="line">            newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 当前数组没有数据，使用初始化的值</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>) <span class="comment">// initial capacity was placed in threshold</span></span><br><span class="line">        newCap = oldThr;</span><br><span class="line">    <span class="keyword">else</span> &#123;               <span class="comment">// zero initial threshold signifies using defaults</span></span><br><span class="line">        <span class="comment">// 如果初始化的值为 0，则使用默认的初始化容量</span></span><br><span class="line">        newCap = DEFAULT_INITIAL_CAPACITY;</span><br><span class="line">        newThr = (<span class="keyword">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果新的容量等于 0</span></span><br><span class="line">    <span class="keyword">if</span> (newThr == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">float</span> ft = (<span class="keyword">float</span>)newCap * loadFactor;</span><br><span class="line">        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="keyword">float</span>)MAXIMUM_CAPACITY ?</span><br><span class="line">                  (<span class="keyword">int</span>)ft : Integer.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line">    threshold = newThr; </span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(&#123;<span class="string">"rawtypes"</span>,<span class="string">"unchecked"</span>&#125;)</span><br><span class="line">    Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node[newCap];</span><br><span class="line">    <span class="comment">// 开始扩容，将新的容量赋值给 table</span></span><br><span class="line">    table = newTab;</span><br><span class="line">    <span class="comment">// 原数据不为空，将原数据复制到新 table 中</span></span><br><span class="line">    <span class="keyword">if</span> (oldTab != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 根据容量循环数组，复制非空元素到新 table</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class="line">            Node&lt;K,V&gt; e;</span><br><span class="line">            <span class="keyword">if</span> ((e = oldTab[j]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                oldTab[j] = <span class="keyword">null</span>;</span><br><span class="line">                <span class="comment">// 如果链表只有一个，则进行直接赋值</span></span><br><span class="line">                <span class="keyword">if</span> (e.next == <span class="keyword">null</span>)</span><br><span class="line">                    newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                    <span class="comment">// 红黑树相关的操作</span></span><br><span class="line">                    ((TreeNode&lt;K,V&gt;)e).split(<span class="keyword">this</span>, newTab, j, oldCap);</span><br><span class="line">                <span class="keyword">else</span> &#123; <span class="comment">// preserve order</span></span><br><span class="line">                    <span class="comment">// 链表复制，JDK 1.8 扩容优化部分</span></span><br><span class="line">                    Node&lt;K,V&gt; loHead = <span class="keyword">null</span>, loTail = <span class="keyword">null</span>;</span><br><span class="line">                    Node&lt;K,V&gt; hiHead = <span class="keyword">null</span>, hiTail = <span class="keyword">null</span>;</span><br><span class="line">                    Node&lt;K,V&gt; next;</span><br><span class="line">                    <span class="keyword">do</span> &#123;</span><br><span class="line">                        next = e.next;</span><br><span class="line">                        <span class="comment">// 原索引</span></span><br><span class="line">                        <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (loTail == <span class="keyword">null</span>)</span><br><span class="line">                                loHead = e;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                loTail.next = e;</span><br><span class="line">                            loTail = e;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// 原索引 + oldCap</span></span><br><span class="line">                        <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (hiTail == <span class="keyword">null</span>)</span><br><span class="line">                                hiHead = e;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                hiTail.next = e;</span><br><span class="line">                            hiTail = e;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">while</span> ((e = next) != <span class="keyword">null</span>);</span><br><span class="line">                    <span class="comment">// 将原索引放到哈希桶中</span></span><br><span class="line">                    <span class="keyword">if</span> (loTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        loTail.next = <span class="keyword">null</span>;</span><br><span class="line">                        newTab[j] = loHead;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 将原索引 + oldCap 放到哈希桶中</span></span><br><span class="line">                    <span class="keyword">if</span> (hiTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        hiTail.next = <span class="keyword">null</span>;</span><br><span class="line">                        newTab[j + oldCap] = hiHead;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newTab;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JDK1.8并不需要像JDK1.7为每个值计算新的hash值，而是通过<code>e.hassh&amp;oldCap</code>来计算是否需要移动。</p>
<h4 id="多线程死循环"><a href="#多线程死循环" class="headerlink" title="多线程死循环"></a>多线程死循环</h4><p><a href="https://coolshell.cn/articles/9606.html#comments" target="_blank" rel="noopener">疫苗：JAVA HASHMAP的死循环</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">transfer</span><span class="params">(Entry[] newTable, <span class="keyword">boolean</span> rehash)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> newCapacity = newTable.length;</span><br><span class="line">    <span class="keyword">for</span> (Entry&lt;K,V&gt; e : table) &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">null</span> != e) &#123;</span><br><span class="line">            Entry&lt;K,V&gt; next = e.next; <span class="comment">// 线程一执行此处</span></span><br><span class="line">            <span class="keyword">if</span> (rehash) &#123;</span><br><span class="line">                e.hash = <span class="keyword">null</span> == e.key ? <span class="number">0</span> : hash(e.key);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">int</span> i = indexFor(e.hash, newCapacity);</span><br><span class="line">            e.next = newTable[i];</span><br><span class="line">            newTable[i] = e;</span><br><span class="line">            e = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在JDK1.7链表插入的方法是头部插入，然后多线程执行的时候会出现循环，这样会导致get的时候cpu爆了。</p>
<p>在JDK1.8链表插入的方法就变成尾部插入，这样能够缓解这个问题，但是还是不安全。</p>
<h4 id="为什么加载因子是0-75"><a href="#为什么加载因子是0-75" class="headerlink" title="为什么加载因子是0.75"></a>为什么加载因子是0.75</h4><p>出于容量和性能的考虑，如果加载因子比较大的时候，那么Hash冲突比较大，对元素的操作性能就会比较低。如果加载因子比较小的时候，那么就会频繁扩容，这样元素存储就比较稀疏，这样操作的性能就会比较高。</p>
<p>然后通过概率论的知识选择0.5到1之间的均值。</p>
<h2 id="HashTable"><a href="#HashTable" class="headerlink" title="HashTable"></a>HashTable</h2><p><a href="https://www.baeldung.com/hashmap-hashtable-differences" target="_blank" rel="noopener">Differences Between HashMap and Hashtable</a></p>
<blockquote>
<p>Hashtable is thread-safe, but it uses synchronized method to synchronize. Both insert and read data are synchronized. When inserting data, it can not read (equivalent to locking the whole Hashtable, full publication lock). When multi-threaded concurrent situation. All of them have to compete for the same lock, resulting in extremely low efficiency. </p>
</blockquote>
<p>HashTable是历史遗留问题，与HashMap基本相同，但是不同的是它是线程安全的。在JDK1.8已经被丢弃了，一般使用<code>ConcurrentHashMap</code>来替代在多线程中使用Map的场景。</p>
<h2 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h2><p><a href="https://www.baeldung.com/java-concurrent-map" target="_blank" rel="noopener">A Guide to ConcurrentMap</a></p>
<p>ConcurrentMap解决了HashMap在多线程中不是线程安全的问题</p>
<h3 id="源码分析-1"><a href="#源码分析-1" class="headerlink" title="源码分析"></a>源码分析</h3><p><a href="https://programmer.ink/think/analysis-of-concurrent-hashmap-principle.html" target="_blank" rel="noopener">Analysis of Concurrent HashMap Principle</a></p>
<p>ConcurrentHashMap在实现上与HashMap基本相同。</p>
<p>在JDK1.7中使用的分段，把数组分成一个个段，然后每个线程要访问数据时，都要获得该段的锁，提高了并发度。默认是有16个段。</p>
<p>在JDK1.8使用的CAS来支持更高的并发度。</p>
<h4 id="CAS"><a href="#CAS" class="headerlink" title="CAS"></a>CAS</h4><p><a href="https://www.cnblogs.com/xrq730/p/4976007.html" target="_blank" rel="noopener">Unsafe与CAS</a></p>
<p>CAS就是Compare and Swap就对于每个操作都是先比较在交换。例如要修改某个值(内存为4)，那么预期值(4)，修改的值(5)，只有当内存值与预期值相等【比较】，才将内存值修改为(5)，并且在比较-交换这个过程中是具有原子性的。</p>
<h2 id="LinkedHashMap"><a href="#LinkedHashMap" class="headerlink" title="LinkedHashMap"></a>LinkedHashMap</h2><p>基于双向链表来保证插入的顺序</p>
<h1 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h1><p>在Java中，如果某个.java文件需要运行，会先将其编译成.class文件，然后加载到jvm中。</p>
<p>反射允许在程序运行时，获取自身的信息，并且可以操作类或者对象的内部属性。</p>
<p>Class和java.lang.reflect一起对反射提供了支持</p>
<ol>
<li>Field可以使用get,set方法读取和修改Field对象关联的字段</li>
<li>Method 可以使用invoke方法调用与Method对象关联的方法</li>
<li>Constructor 可以使用Constructor的newInstance()创建新的对象</li>
</ol>
<h2 id="理解反射"><a href="#理解反射" class="headerlink" title="理解反射"></a>理解反射</h2><h2 id="获得Class对象"><a href="#获得Class对象" class="headerlink" title="获得Class对象"></a>获得Class对象</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Class.forName(driver);</span><br><span class="line">Class mClass=MyClass<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">Class mClass=MyClass.getClass()</span><br></pre></td></tr></table></figure>

<p>具体代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException </span>&#123;</span><br><span class="line">        SonClass sonClass=<span class="keyword">new</span> SonClass();</span><br><span class="line"></span><br><span class="line">        Class className=sonClass.getClass();</span><br><span class="line">        Class className2=SonClass<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">        Class className3=Class.forName(<span class="string">"javabasic.reflectDemo.SonClass"</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(className);</span><br><span class="line">        System.out.println(className2);</span><br><span class="line">        System.out.println(className3);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="创建实例"><a href="#创建实例" class="headerlink" title="创建实例"></a>创建实例</h2><ol>
<li>通过Class对象的newInstance方法创建对象的实例</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IllegalAccessException, InstantiationException </span>&#123;</span><br><span class="line">       Class className=SonClass<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">       Object object=className.newInstance();</span><br><span class="line">       System.out.println(className.isInstance(object));</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h1 id="测试Junit"><a href="#测试Junit" class="headerlink" title="测试Junit"></a>测试Junit</h1><blockquote>
<p>JUnit is an open source Unit Testing Framework for JAVA. It is useful for Java Developers to write and run repeatable tests.</p>
</blockquote>
<h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><p><img src="http://cdn.xuxiaojin.com/202007291534_845.png" alt=""></p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JunitAnnotationsExample</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;String&gt; list;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeClass</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">m1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Using @Beforeclass,executed before all test case"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        System.out.println(<span class="string">"Using @Before annotations,executed before each test case"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterClass</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">m3</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Using @Afterclass,executed after all test case"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m4</span><span class="params">()</span></span>&#123;</span><br><span class="line">        list.clear();</span><br><span class="line">        System.out.println(<span class="string">"Using @After,executed after each test cases"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m5</span><span class="params">()</span></span>&#123;</span><br><span class="line">        list.add(<span class="string">"test"</span>);</span><br><span class="line">        assertFalse(list.isEmpty());</span><br><span class="line">        assertEquals(<span class="number">1</span>,list.size());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Ignore</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m6</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Using @Ignore,this execution is ignored"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span>(timeout = <span class="number">10</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m7</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Using @Test(timeout),it can be used to enforce timeout in JUnit TEST CASE"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span>(expected = NoSuchMethodException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">void</span> <span class="title">m8</span>() </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Using @Test(expected) ,it will check for specified exception during its execution"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@BeforeClass</code>和<code>@AfterClass</code>的方法必须是<code>static</code>修饰的。</p>
<h2 id="Assert-Class"><a href="#Assert-Class" class="headerlink" title="Assert Class"></a>Assert Class</h2><p><img src="http://cdn.xuxiaojin.com/202007291557_154.png" alt=""></p>
<h3 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Junit4AssertionTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAssert</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String string1=<span class="string">"Junit"</span>;</span><br><span class="line">        String string2=<span class="string">"Junit"</span>;</span><br><span class="line">        String string3=<span class="keyword">new</span> String(<span class="string">"test"</span>);</span><br><span class="line">        String string4=<span class="string">"test"</span>;</span><br><span class="line">        String string5=<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span> variable1=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> variable2=<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span>[] airethematicArray1=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line">        <span class="keyword">int</span>[] airethematicArray2=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"></span><br><span class="line">        assertEquals(string1,string2);</span><br><span class="line">        assertSame(string3,string4);</span><br><span class="line"></span><br><span class="line">        assertNotSame(string1, string3);</span><br><span class="line">        assertNotNull(string1);</span><br><span class="line">        assertNull(string5);</span><br><span class="line">        assertTrue(variable1&lt;variable2);</span><br><span class="line">        assertArrayEquals(airethematicArray1, airethematicArray2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="并发编程"><a href="#并发编程" class="headerlink" title="并发编程"></a>并发编程</h1><h2 id="使用线程"><a href="#使用线程" class="headerlink" title="使用线程"></a>使用线程</h2><h3 id="创建线程"><a href="#创建线程" class="headerlink" title="创建线程"></a>创建线程</h3><p><a href="http://tutorials.jenkov.com/java-concurrency/creating-and-starting-threads.html" target="_blank" rel="noopener">Creating and Starting Java Threads</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Thread thread=<span class="keyword">new</span> Thread();</span><br><span class="line">thread.start();</span><br></pre></td></tr></table></figure>

<p>上面这个例子没有需要执行的代码，所以在start后，该线程会马上结束。有两种提供运行的代码的方式。</p>
<ol>
<li>创建一个thread的子类，并且实现run()方法</li>
<li>传递一个object，该object实现了Runable接口</li>
</ol>
<h3 id="继承Thread"><a href="#继承Thread" class="headerlink" title="继承Thread"></a>继承Thread</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Mythread running"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Thread thread=<span class="keyword">new</span> Thread()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"Thread Running"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="实现Runnable接口"><a href="#实现Runnable接口" class="headerlink" title="实现Runnable接口"></a>实现Runnable接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Runnable running"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要实现run方法，并且需要创建Thread实例，调用Thread的start()方法来启动线程。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MyRunnable myRunnable=<span class="keyword">new</span> MyRunnable();</span><br><span class="line">Thread thread=<span class="keyword">new</span> Thread(myRunnable);</span><br><span class="line">thread.start();</span><br></pre></td></tr></table></figure>

<h3 id="实现Callable接口"><a href="#实现Callable接口" class="headerlink" title="实现Callable接口"></a>实现Callable接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCallable</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">123</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>与Runnable相比，Callable有返回值，通过FutureTask进行封装</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        MyCallable myCallable=<span class="keyword">new</span> MyCallable();</span><br><span class="line">        FutureTask&lt;Integer&gt; ft=<span class="keyword">new</span> FutureTask&lt;&gt;(myCallable);</span><br><span class="line">        Thread thread=<span class="keyword">new</span> Thread(ft);</span><br><span class="line">        thread.start();</span><br><span class="line">        System.out.println(ft.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://www.baeldung.com/java-runnable-callable" target="_blank" rel="noopener">Runnable vs. Callable in Java</a></p>
<h3 id="实现Runnable接口-VS-继承Thread类"><a href="#实现Runnable接口-VS-继承Thread类" class="headerlink" title="实现Runnable接口 VS 继承Thread类"></a>实现Runnable接口 VS 继承Thread类</h3><p>实现Runnable接口比继承Thread类要好。</p>
<ol>
<li>Runnable里只有一个run()方法，定义了需要执行的内容。实现Runnable和Thread类的解耦。</li>
<li>使用继承Thread类，每执行一个任务就需要新建一个线程。而实现Runnable接口，则可以把该任务传入线程池，使用固定的线程来完成任务。不需要每次新建销毁线程，大大降低了性能开销。</li>
<li>Java语言不支持多继承，一旦继承Thread类后就无法在日后进行扩展。</li>
</ol>
<h2 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h2><p><a href="https://www.baeldung.com/thread-pool-java-and-guava" target="_blank" rel="noopener">Introduction to Thread Pools in Java</a></p>
<h3 id="线程池的参数"><a href="#线程池的参数" class="headerlink" title="线程池的参数"></a>线程池的参数</h3><table>
<thead>
<tr>
<th>参数名</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>corePoolSize</td>
<td>核心线程数</td>
</tr>
<tr>
<td>maxPoolSize</td>
<td>最大线程数</td>
</tr>
<tr>
<td>keepAliveTime+时间单位</td>
<td>空闲线程存活的时间</td>
</tr>
<tr>
<td>ThreadFactory</td>
<td>线程工厂用来创建新线程</td>
</tr>
<tr>
<td>workQueue</td>
<td>用于存放任务队列</td>
</tr>
<tr>
<td>Handler</td>
<td>处理被拒绝的任务</td>
</tr>
</tbody></table>
<h3 id="线程创建的时机"><a href="#线程创建的时机" class="headerlink" title="线程创建的时机"></a>线程创建的时机</h3><p><img src="http://cdn.xuxiaojin.com/202007281507_796.png" alt=""></p>
<ol>
<li>首先提交任务</li>
<li>然后判断当前线程池里的corePoolSize是否已满，如果没有满的话，那么会创建一个核心线程并且执行任务。如果满的话则执行下一步</li>
<li>判断工作队列workQueue是否已满，如果没有满的话，就会把任务放到工作队列里去。等待核心线程执行完当前自己的任务后，从工作队列中提取正在等待被执行的任务。如果工作队列已满的话，达到了workQueue的容量上限，则执行下一步</li>
<li>判断当前的线程池的maxPoolSize是否已满，如果没有满的话，则会创建非核心线程执行任务，并且创建的非核心线程在空闲的时候等待keepAliveTime时间后会被销毁，核心线程不会被销毁。如果已满的话，则会执行下一步</li>
<li>如果corePoolSize、workQueue、maxPoolSize都无法满足，则会根据拒绝策略处理无法执行的任务</li>
</ol>
<h3 id="拒绝策略"><a href="#拒绝策略" class="headerlink" title="拒绝策略"></a>拒绝策略</h3><h4 id="AbortPolicy"><a href="#AbortPolicy" class="headerlink" title="AbortPolicy"></a>AbortPolicy</h4><p>在拒绝任务时候会抛出一个<code>RejectedExecutionException</code>的<code>RuntimeException</code>，这样可以知道任务被拒绝了，然后可以根据业务逻辑选择重试或者放弃提交等策略</p>
<h4 id="DiscardPolicy"><a href="#DiscardPolicy" class="headerlink" title="DiscardPolicy"></a>DiscardPolicy</h4><p>拒绝任务的时候直接抛弃，不会有任务提示，可能造成数据丢失</p>
<h4 id="DiscardPolicy-1"><a href="#DiscardPolicy-1" class="headerlink" title="DiscardPolicy"></a>DiscardPolicy</h4><p>拒绝任务的时候直接抛弃在工作队列中存活最长的任务，这样就可以给新任务腾出空间，但是也会造成数据丢失</p>
<h4 id="CallerRunsPolicy"><a href="#CallerRunsPolicy" class="headerlink" title="CallerRunsPolicy"></a>CallerRunsPolicy</h4><p>拒绝任务的时候会把这个任务交给提交任务的线程执行。有以下这些好处</p>
<ol>
<li>提交的任务不会丢弃</li>
<li>由于执行任务需要耗时，这样就无法提交新的任务，然后线程池就可以执行一定的任务，为后续的任务腾出空间，相当于给了一定的缓冲期</li>
</ol>
<h3 id="常见线程池"><a href="#常见线程池" class="headerlink" title="常见线程池"></a>常见线程池</h3><table>
<thead>
<tr>
<th>参数</th>
<th>FixedThreadPool</th>
<th>CachedThreadPool</th>
<th>ScheduledThreadPool</th>
<th>SingleThreadPool</th>
<th>SingleScheduledThreadPool</th>
</tr>
</thead>
<tbody><tr>
<td>corePoolSize</td>
<td>构造函数传入</td>
<td>0</td>
<td>构造函数传入</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>maxPoolSize</td>
<td>同corePoolSize</td>
<td>Integer.MAX_VALUE</td>
<td>Integer.MAX_VALUE</td>
<td>1</td>
<td>Integer.MAX_VALUE</td>
</tr>
<tr>
<td>keepAliveTime</td>
<td>0</td>
<td>60s</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>说明</td>
<td>这是一个固定线程数的线程池</td>
<td>提交一个任务就会判断是否有空闲的线程，若有则指派个空闲的线程。如果没有的话就新建线程去执行。</td>
<td>支持定时或者周期性执行任务</td>
<td>固定线程数的线程池，这里的线程只有一个。如果在中途发生错误，则会新建一个新的线程来执行任务。适用于顺讯执行的任务。</td>
<td>ScheduledThreadPool的特例</td>
</tr>
</tbody></table>
<h4 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFixedThreadPool</span><span class="params">()</span></span>&#123;</span><br><span class="line">       ThreadPoolExecutor executor=(ThreadPoolExecutor) Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line">       executor.submit(()-&gt;&#123;</span><br><span class="line">           Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">       &#125;);</span><br><span class="line">       executor.submit(()-&gt;&#123;</span><br><span class="line">           Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">       &#125;);</span><br><span class="line">       executor.submit(()-&gt;&#123;</span><br><span class="line">           Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">       &#125;);</span><br><span class="line">       assertEquals(<span class="number">2</span>,executor.getPoolSize());</span><br><span class="line">       assertEquals(<span class="number">1</span>,executor.getQueue().size());</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCachedThreadPool</span><span class="params">()</span></span>&#123;</span><br><span class="line">       ThreadPoolExecutor executor= (ThreadPoolExecutor) Executors.newCachedThreadPool();</span><br><span class="line">       executor.submit(()-&gt;&#123;</span><br><span class="line">           Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">       &#125;);</span><br><span class="line">       executor.submit(()-&gt;&#123;</span><br><span class="line">           Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">       &#125;);</span><br><span class="line">       executor.submit(()-&gt;&#123;</span><br><span class="line">           Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">       &#125;);</span><br><span class="line">       assertEquals(<span class="number">3</span>,executor.getPoolSize());</span><br><span class="line">       assertEquals(<span class="number">0</span>,executor.getQueue().size());</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSingleThreadPool</span><span class="params">()</span></span>&#123;</span><br><span class="line">       AtomicInteger counter=<span class="keyword">new</span> AtomicInteger();</span><br><span class="line">       ExecutorService executorService=Executors.newSingleThreadExecutor();</span><br><span class="line">       executorService.submit(()-&gt;&#123;</span><br><span class="line">           counter.set(<span class="number">1</span>);</span><br><span class="line">       &#125;);</span><br><span class="line">       executorService.submit(()-&gt;&#123;</span><br><span class="line">           counter.compareAndSet(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testScheduledThreadPool</span><span class="params">()</span></span>&#123;</span><br><span class="line">       ScheduledExecutorService executor=Executors.newScheduledThreadPool(<span class="number">5</span>);</span><br><span class="line">       executor.schedule(()-&gt;&#123;</span><br><span class="line">           System.out.println(<span class="string">"hello world"</span>);</span><br><span class="line">       &#125;,<span class="number">500</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="ForkJoinPool"><a href="#ForkJoinPool" class="headerlink" title="ForkJoinPool"></a>ForkJoinPool</h3><p><a href="https://www.baeldung.com/java-fork-join#forkJoinPool" target="_blank" rel="noopener">Guide to the Fork/Join Framework in Java</a></p>
<p><code>ForkJoinPool</code>与其他线程不同的地方在与两处</p>
<ol>
<li>适合于子任务拆分，第一步是拆分任务fork，第二步就是汇总子任务的结果join</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Fibonacci</span> <span class="keyword">extends</span> <span class="title">RecursiveTask</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Fibonacci</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.n=n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Integer <span class="title">compute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(n&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> n;</span><br><span class="line">        &#125;</span><br><span class="line">        Fibonacci f1=<span class="keyword">new</span> Fibonacci(n-<span class="number">1</span>);</span><br><span class="line">        f1.fork();</span><br><span class="line">        Fibonacci f2=<span class="keyword">new</span> Fibonacci(n-<span class="number">2</span>);</span><br><span class="line">        f2.fork();</span><br><span class="line">        <span class="keyword">return</span> f1.join()+f2.join();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>底层实现的不同，与其他线程池类似的是都有一个公共的队列，如果发生任务拆分，每个线程都有一个工作队列(双端队列)，这样可以减少队列去公共的工作队列获取工作时，发生阻塞。然后同时还会有一个<code>work-steal</code>的机制，就是当某个线程完成自己的工作后，就会去其他比较繁忙的工作队列中，从尾部获取新的工作。</li>
</ol>
<h3 id="使用线程池"><a href="#使用线程池" class="headerlink" title="使用线程池"></a>使用线程池</h3><ol>
<li>线程池解决了线程生命周期的系统开销问题，加快了响应的速度。因为线程池里的线程是可以复用的，只用少量线程去执行大量任务。减少了一个任务一个线程的创建和回收开销。</li>
<li>线程池可以根据任务和配置灵活地控制线程数量，不够的时候就创建，太多的时候就回收。避免线程过多导致内存溢出，或者线程太少导致CPU资源浪费。</li>
<li>线程池可以同一管理资源</li>
</ol>
<h2 id="线程状态"><a href="#线程状态" class="headerlink" title="线程状态"></a>线程状态</h2><p><a href="https://time.geekbang.org/column/article/86366" target="_blank" rel="noopener">Java线程（上）：Java线程的生命周期</a></p>
<h3 id="NEW-初始化状态"><a href="#NEW-初始化状态" class="headerlink" title="NEW-初始化状态"></a>NEW-初始化状态</h3><p>这里是编程语言特有的，在编程语言层面被创建。在操作系统层面并没有被创建。</p>
<p>指的是线程已经被创建，但还不允许分配CPU执行。</p>
<h3 id="RUNNABLE-可运行状态"><a href="#RUNNABLE-可运行状态" class="headerlink" title="RUNNABLE-可运行状态"></a>RUNNABLE-可运行状态</h3><p>线程可以分配CPU执行，在这种状态下，真正的操作系统线程已经被成功创建。</p>
<p>当有空闲的CPU的时候，操作系统会将其分配一个可运行状态的线程，将分配到CPU的线程状态转变成运行状态。</p>
<h3 id="BLOCKED-阻塞状态"><a href="#BLOCKED-阻塞状态" class="headerlink" title="BLOCKED-阻塞状态"></a>BLOCKED-阻塞状态</h3><p>当线程在等待<code>synchronized</code>的隐式锁。synchronized修饰的方法、代码块同一时刻只能允许一个线程执行。这个时候，在等待的线程就会从<code>RUNNALBE</code>转换到<code>BLOCKED</code>状态，而当等待的线程获得synchronized的隐式锁，就会从blocked转换到runnable状态。</p>
<h3 id="WAITING-无时限等待"><a href="#WAITING-无时限等待" class="headerlink" title="WAITING-无时限等待"></a>WAITING-无时限等待</h3><p>等待其它线程显式地唤醒。等待与阻塞的区别是，等待是主动的，调用<code>Object.wait()</code>，阻塞是被动的，等待获取synchronized隐式锁。</p>
<table>
<thead>
<tr>
<th>进入方法</th>
<th>退出方法</th>
</tr>
</thead>
<tbody><tr>
<td>Object.wait()方法</td>
<td>Object.notify()/Object.notifyAll()</td>
</tr>
<tr>
<td>Thread.join()</td>
<td>被调用的线程执行完毕</td>
</tr>
<tr>
<td>LockSupport.park()</td>
<td>LockSupport.unpark(Thread)</td>
</tr>
</tbody></table>
<h3 id="TIMED-WAITING-有时限等待"><a href="#TIMED-WAITING-有时限等待" class="headerlink" title="TIMED_WAITING-有时限等待"></a>TIMED_WAITING-有时限等待</h3><p>无需等待其它线程显式唤醒，在一定的时间内能够自动被唤醒。</p>
<table>
<thead>
<tr>
<th>进入方法</th>
<th>退出方法</th>
</tr>
</thead>
<tbody><tr>
<td>Thread.sleep(long millis)</td>
<td>时间结束</td>
</tr>
<tr>
<td>Object.wait(long timeout)</td>
<td>时间结束/Object.notify()/Object.notifyAll()</td>
</tr>
<tr>
<td>Thread.join(long millis)</td>
<td>时间结束/被调用的线程执行完毕</td>
</tr>
<tr>
<td>LockSupport.parkNanos(Object blocker,long deadline)</td>
<td>LockSupport.unpark(Thread)</td>
</tr>
<tr>
<td>LockSupport.parkUnit(long deadline)</td>
<td>LockSupport.unpark(Thread)</td>
</tr>
</tbody></table>
<p>有时限的等待超时与无限等待的区别是<code>设置了超时参数</code>。</p>
<h3 id="TERMINATED-终止状态"><a href="#TERMINATED-终止状态" class="headerlink" title="TERMINATED-终止状态"></a>TERMINATED-终止状态</h3><p>线程执行完run()方法后，会自动转换到TERMINATED状态，或者是执行run()方法的时候抛出异常，也会导致线程终止。</p>
<h2 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h2><h3 id="悲观锁和乐观锁"><a href="#悲观锁和乐观锁" class="headerlink" title="悲观锁和乐观锁"></a>悲观锁和乐观锁</h3><p><code>悲观锁</code>为了确保结果的正确性，在每次获取并修改数据的同时，都把数据锁住，让其它线程无法访问该数据。这样就可以保证数据万无一失。</p>
<p><code>乐观锁</code>并不会锁住被操作的对象，而是在需要修改数据的时候，把当前数据与自己的预期值进行比对。如果一样说明在修改的期间没有其他线程修改过，可以正常修改。如果不一致，那么就说明有人修改了，那么会放弃这次修改，并选择报错或者重试等策略。</p>
<h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><p><code>悲观锁</code>：synchronized关键词和lock接口，其中Lock的实现类ReentrantLock中的lock等方法就执行加锁操作，unlock就是执行解锁操作。处理资源前必须拿到锁，处理完后在解开锁。</p>
<p><code>乐观锁</code>：原子类，比如AtomicInteger在更新数据时就会使用CAS思想。</p>
<h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h4><p><code>悲观锁</code>适合用于并发写入多，临界区代码复杂，竞争激烈等场景，这样使用悲观锁可以避免大量无用反复尝试等操作。</p>
<p><code>乐观锁</code>用于大量读取，少量修改的场景，这种情况下乐观锁不加锁的特点能够让性能大幅提高。</p>
<h3 id="synchronized和Lock"><a href="#synchronized和Lock" class="headerlink" title="synchronized和Lock"></a>synchronized和Lock</h3><h4 id="相同点"><a href="#相同点" class="headerlink" title="相同点"></a>相同点</h4><ol>
<li>都用来保护资源的线程安全</li>
<li>都可以保证可见性</li>
<li>都有<code>可重入</code>的特点，可重入指的是如果一个线程拥有某个资源的锁，试图再次请求这个锁，那么不需要提前释放这个锁，而是可以继续使用持有的这个锁。</li>
</ol>
<h3 id="公平锁和非公平锁"><a href="#公平锁和非公平锁" class="headerlink" title="公平锁和非公平锁"></a>公平锁和非公平锁</h3><p><code>公平锁</code>指的是线程获得锁的顺序是按照先来后到的顺序</p>
<p><code>非公平锁</code>指的是可以插队，例如某个线程A获得了锁，此时有线程B、C正在尝试获得锁，因为没有拿到，那么就会放到等待队列里。此时线程A释放锁，并且线程D也在尝试获取锁，那么线程D会获取锁。线程B、C并不会获得到锁。</p>
<h3 id="读写锁"><a href="#读写锁" class="headerlink" title="读写锁"></a>读写锁</h3><p><code>ReentrantReadWriteLock</code></p>
<p>读写锁指的是如果一个线程获得到了读锁，那么其他线程也只能获得读锁，并不能获得写锁。如果一个线程获得到了写锁，那么其他线程不管要获取什么锁都只能等待该线程释放写锁。</p>
<h2 id="原子类"><a href="#原子类" class="headerlink" title="原子类"></a>原子类</h2><blockquote>
<p>无锁的方案相对于加锁的方案最大的好处就是性能。</p>
</blockquote>
<h3 id="无锁方案"><a href="#无锁方案" class="headerlink" title="无锁方案"></a>无锁方案</h3><p><code>CPU</code>为了解决并发问题，提供了CAS指令，CAS指令包含三个参数，共享变量的地址A，用于比较的值B和共享变量的新值C。CAS本身指令是可以保证原子性的。</p>
<h3 id="Atomic-基本类型原子类"><a href="#Atomic-基本类型原子类" class="headerlink" title="Atomic\基本类型原子类"></a>Atomic\基本类型原子类</h3><p>如果要一个整型变量，并且这个变量会被运用在并发场景之下，那不能使用int、Integer而是应该直接使用AtomicInteger</p>
<h3 id="Atomic-Reference引用类型原子类"><a href="#Atomic-Reference引用类型原子类" class="headerlink" title="Atomic\Reference引用类型原子类"></a>Atomic\Reference引用类型原子类</h3><p>三种AtomicReference引用类型原子类。</p>
<ul>
<li>AtomicStampedReference是对AtomicReference的升级，并且加上了时间戳解决了CAS的ABA的问题。</li>
<li>AtomicMarkableReference和AtomicReference类似，多了个绑定的布尔值，可以用来表示该对象是否已经删除的场景。</li>
</ul>
<h3 id="原子化数组"><a href="#原子化数组" class="headerlink" title="原子化数组"></a>原子化数组</h3><p>相关实现有<code>AtomicIntegerArray</code>、<code>AtomicLongArray</code>和<code>AtomicReferenceArray</code>,可以 原子化的更新数组里面的每一个元素。</p>
<h3 id="AtomicInteger高并发性能不好"><a href="#AtomicInteger高并发性能不好" class="headerlink" title="AtomicInteger高并发性能不好"></a>AtomicInteger高并发性能不好</h3><p>每次如果有数值上的更新，都需要进行flush和refresh，这样的操作耗费了很多资源，而且CAS也会经常失败。</p>
<h4 id="LongAdder带来改进和原理"><a href="#LongAdder带来改进和原理" class="headerlink" title="LongAdder带来改进和原理"></a>LongAdder带来改进和原理</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LongAdderDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        LongAdder counter=<span class="keyword">new</span> LongAdder();</span><br><span class="line">        ExecutorService service= Executors.newFixedThreadPool(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++)&#123;</span><br><span class="line">            service.submit(<span class="keyword">new</span> Task(counter));</span><br><span class="line">        &#125;</span><br><span class="line">        Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        System.out.println(counter.sum());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> LongAdder counter;</span><br><span class="line"></span><br><span class="line">        Task(LongAdder counter) &#123;</span><br><span class="line">            <span class="keyword">this</span>.counter = counter;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            counter.increment();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为LongAdder引入了分段累加的概念，内部有两个参数参与技术，一个叫base是一个变量，第二个是Cell[]是个数组。如果竞争不激烈，直接把累加的结果改到base变量，如果竞争激烈的话，每个线程都会加到各自所对应的cell[]数组中的某一个对象中。</p>

      
    </div>
    
    
    

    <div>
      
        
      
</div>

    

    

    
      <div>
        <!-- JS库 clipboard 拷贝内容到粘贴板-->
<script src="https://cdn.bootcss.com/clipboard.js/2.0.1/clipboard.min.js"></script>

<!-- JS库 sweetalert 显示提示信息-->
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<ul class="post-copyright">
  <!-- 本文标题 -->
  <li>
    <strong>本文标题： </strong>
    这一次重新学习Java
  </li>

  <!-- 本文作者 -->
  <li class="post-copyright-author">
    <strong>本文作者： </strong>
    XuxiaoJin   |  徐小晋
  </li>

  <!-- 创建时间 -->
  <li>
    <strong>创建于： </strong>
    2020年07月22日 - 00时07分
  </li>

  <!-- 修改时间 -->
  <li>
    <strong>更新于： </strong>
    2020年08月10日 - 22时08分
  </li>

  <!-- 引用链接 -->
  <li class="post-copyright-link">
    <strong>引用链接：</strong>
    <a href="http://blog.xuxiaojin.com/3681760259.html" title="这一次重新学习Java"
      >http://blog.xuxiaojin.com/3681760259.html</a
    >
    <span class="copy-path" title="点击复制引用链接"
      ><i
        style="cursor: pointer"
        class="fa fa-clipboard"
        data-clipboard-text="[XuxiaoJin's Blog | 这一次重新学习Java](http://blog.xuxiaojin.com/3681760259.html)"
        aria-label="post.copy_success"
      ></i
    ></span>
  </li>

  <!-- 版权声明 -->
  <li class="post-copyright-license">
    <strong
      >版权声明：
    </strong>
    本博客所有文章除特别声明外，均采用 CC BY-NC-SA 3.0 许可协议。转载请注明出处！
  </li>
</ul>

<script>
  var clipboard = new ClipboardJS(".fa-clipboard");
  clipboard.on("success", function(target) {
    var message = document.createElement("div");
    message.innerHTML =
      '<i class="fa fa-check-circle message-icon"></i><span class="message-content">' +
      target.trigger.getAttribute("aria-label") +
      "</span>";
    swal({
      content: message,
      className: "copy-success-message",
      timer: 1000,
      button: false
    });
  });
</script>
      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"><i class="fa fa-tag"></i> Java</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/1705670517.html" rel="next" title="设计模式--门面模式">
                <i class="fa fa-chevron-left"></i> 设计模式--门面模式
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/735104786.html" rel="prev" title="正则入门">
                正则入门 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>

  <div>
    
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">------ 本文结束------</div>
    
</div>
    
 </div>
  
  
  
  </article>





    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/author.jpg"
                alt="徐晋" />
            
              <p class="site-author-name" itemprop="name">徐晋</p>
              <p class="site-description motion-element" itemprop="description">君子知命不惧，自当日日自新</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">108</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">56</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/jiayouxujin" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="1319039722@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-E-Mail"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#内存模型"><span class="nav-number">1.</span> <span class="nav-text">内存模型</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#线程栈"><span class="nav-number">1.1.</span> <span class="nav-text">线程栈</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#堆"><span class="nav-number">1.2.</span> <span class="nav-text">堆</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#方法区"><span class="nav-number">1.3.</span> <span class="nav-text">方法区</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#关键词"><span class="nav-number">2.</span> <span class="nav-text">关键词</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#final"><span class="nav-number">2.1.</span> <span class="nav-text">final</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#数据"><span class="nav-number">2.1.1.</span> <span class="nav-text">数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#方法"><span class="nav-number">2.1.2.</span> <span class="nav-text">方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#类"><span class="nav-number">2.1.3.</span> <span class="nav-text">类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#final解决并发问题"><span class="nav-number">2.1.4.</span> <span class="nav-text">final解决并发问题</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#String"><span class="nav-number">3.</span> <span class="nav-text">String</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#概述"><span class="nav-number">3.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#不可变"><span class="nav-number">3.2.</span> <span class="nav-text">不可变</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#不可变的对象"><span class="nav-number">3.2.1.</span> <span class="nav-text">不可变的对象</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#String-Pool"><span class="nav-number">3.3.</span> <span class="nav-text">String Pool</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#intern"><span class="nav-number">3.4.</span> <span class="nav-text">intern()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#new-String-“abc”"><span class="nav-number">3.5.</span> <span class="nav-text">new String(“abc”)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#String-StringBuffer-StringBuilder"><span class="nav-number">3.6.</span> <span class="nav-text">String StringBuffer StringBuilder</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#可变"><span class="nav-number">3.6.1.</span> <span class="nav-text">可变</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#线程安全"><span class="nav-number">3.6.2.</span> <span class="nav-text">线程安全</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用"><span class="nav-number">3.6.3.</span> <span class="nav-text">使用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#函数"><span class="nav-number">4.</span> <span class="nav-text">函数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#参数传递"><span class="nav-number">4.1.</span> <span class="nav-text">参数传递</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Collection"><span class="nav-number">5.</span> <span class="nav-text">Collection</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Set"><span class="nav-number">5.1.</span> <span class="nav-text">Set</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#TreeSet"><span class="nav-number">5.1.1.</span> <span class="nav-text">TreeSet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HashSet"><span class="nav-number">5.1.2.</span> <span class="nav-text">HashSet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LinkedHashSet"><span class="nav-number">5.1.3.</span> <span class="nav-text">LinkedHashSet</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#List"><span class="nav-number">5.2.</span> <span class="nav-text">List</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ArrayList"><span class="nav-number">5.2.1.</span> <span class="nav-text">ArrayList</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Vector"><span class="nav-number">5.2.2.</span> <span class="nav-text">Vector</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LinkedList"><span class="nav-number">5.2.3.</span> <span class="nav-text">LinkedList</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Queue"><span class="nav-number">5.3.</span> <span class="nav-text">Queue</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#LinkedList-1"><span class="nav-number">5.3.1.</span> <span class="nav-text">LinkedList</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PriorityQueue"><span class="nav-number">5.3.2.</span> <span class="nav-text">PriorityQueue</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Map"><span class="nav-number">6.</span> <span class="nav-text">Map</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#TreeMap"><span class="nav-number">6.1.</span> <span class="nav-text">TreeMap</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HashMap"><span class="nav-number">6.2.</span> <span class="nav-text">HashMap</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#源码分析"><span class="nav-number">6.2.1.</span> <span class="nav-text">源码分析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#put"><span class="nav-number">6.2.1.1.</span> <span class="nav-text">put</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#resize"><span class="nav-number">6.2.1.2.</span> <span class="nav-text">resize</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#多线程死循环"><span class="nav-number">6.2.1.3.</span> <span class="nav-text">多线程死循环</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#为什么加载因子是0-75"><span class="nav-number">6.2.1.4.</span> <span class="nav-text">为什么加载因子是0.75</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HashTable"><span class="nav-number">6.3.</span> <span class="nav-text">HashTable</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ConcurrentHashMap"><span class="nav-number">6.4.</span> <span class="nav-text">ConcurrentHashMap</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#源码分析-1"><span class="nav-number">6.4.1.</span> <span class="nav-text">源码分析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#CAS"><span class="nav-number">6.4.1.1.</span> <span class="nav-text">CAS</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LinkedHashMap"><span class="nav-number">6.5.</span> <span class="nav-text">LinkedHashMap</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#反射"><span class="nav-number">7.</span> <span class="nav-text">反射</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#理解反射"><span class="nav-number">7.1.</span> <span class="nav-text">理解反射</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#获得Class对象"><span class="nav-number">7.2.</span> <span class="nav-text">获得Class对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建实例"><span class="nav-number">7.3.</span> <span class="nav-text">创建实例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#测试Junit"><span class="nav-number">8.</span> <span class="nav-text">测试Junit</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#注解"><span class="nav-number">8.1.</span> <span class="nav-text">注解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#代码"><span class="nav-number">8.1.1.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Assert-Class"><span class="nav-number">8.2.</span> <span class="nav-text">Assert Class</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#代码-1"><span class="nav-number">8.2.1.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#并发编程"><span class="nav-number">9.</span> <span class="nav-text">并发编程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用线程"><span class="nav-number">9.1.</span> <span class="nav-text">使用线程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建线程"><span class="nav-number">9.1.1.</span> <span class="nav-text">创建线程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#继承Thread"><span class="nav-number">9.1.2.</span> <span class="nav-text">继承Thread</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实现Runnable接口"><span class="nav-number">9.1.3.</span> <span class="nav-text">实现Runnable接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实现Callable接口"><span class="nav-number">9.1.4.</span> <span class="nav-text">实现Callable接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实现Runnable接口-VS-继承Thread类"><span class="nav-number">9.1.5.</span> <span class="nav-text">实现Runnable接口 VS 继承Thread类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#线程池"><span class="nav-number">9.2.</span> <span class="nav-text">线程池</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#线程池的参数"><span class="nav-number">9.2.1.</span> <span class="nav-text">线程池的参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#线程创建的时机"><span class="nav-number">9.2.2.</span> <span class="nav-text">线程创建的时机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#拒绝策略"><span class="nav-number">9.2.3.</span> <span class="nav-text">拒绝策略</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#AbortPolicy"><span class="nav-number">9.2.3.1.</span> <span class="nav-text">AbortPolicy</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DiscardPolicy"><span class="nav-number">9.2.3.2.</span> <span class="nav-text">DiscardPolicy</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DiscardPolicy-1"><span class="nav-number">9.2.3.3.</span> <span class="nav-text">DiscardPolicy</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CallerRunsPolicy"><span class="nav-number">9.2.3.4.</span> <span class="nav-text">CallerRunsPolicy</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#常见线程池"><span class="nav-number">9.2.4.</span> <span class="nav-text">常见线程池</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#代码-2"><span class="nav-number">9.2.4.1.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ForkJoinPool"><span class="nav-number">9.2.5.</span> <span class="nav-text">ForkJoinPool</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用线程池"><span class="nav-number">9.2.6.</span> <span class="nav-text">使用线程池</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#线程状态"><span class="nav-number">9.3.</span> <span class="nav-text">线程状态</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#NEW-初始化状态"><span class="nav-number">9.3.1.</span> <span class="nav-text">NEW-初始化状态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RUNNABLE-可运行状态"><span class="nav-number">9.3.2.</span> <span class="nav-text">RUNNABLE-可运行状态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BLOCKED-阻塞状态"><span class="nav-number">9.3.3.</span> <span class="nav-text">BLOCKED-阻塞状态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WAITING-无时限等待"><span class="nav-number">9.3.4.</span> <span class="nav-text">WAITING-无时限等待</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TIMED-WAITING-有时限等待"><span class="nav-number">9.3.5.</span> <span class="nav-text">TIMED_WAITING-有时限等待</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TERMINATED-终止状态"><span class="nav-number">9.3.6.</span> <span class="nav-text">TERMINATED-终止状态</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#锁"><span class="nav-number">9.4.</span> <span class="nav-text">锁</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#悲观锁和乐观锁"><span class="nav-number">9.4.1.</span> <span class="nav-text">悲观锁和乐观锁</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#案例"><span class="nav-number">9.4.1.1.</span> <span class="nav-text">案例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用场景"><span class="nav-number">9.4.1.2.</span> <span class="nav-text">使用场景</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#synchronized和Lock"><span class="nav-number">9.4.2.</span> <span class="nav-text">synchronized和Lock</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#相同点"><span class="nav-number">9.4.2.1.</span> <span class="nav-text">相同点</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#公平锁和非公平锁"><span class="nav-number">9.4.3.</span> <span class="nav-text">公平锁和非公平锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#读写锁"><span class="nav-number">9.4.4.</span> <span class="nav-text">读写锁</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#原子类"><span class="nav-number">9.5.</span> <span class="nav-text">原子类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#无锁方案"><span class="nav-number">9.5.1.</span> <span class="nav-text">无锁方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Atomic-基本类型原子类"><span class="nav-number">9.5.2.</span> <span class="nav-text">Atomic\基本类型原子类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Atomic-Reference引用类型原子类"><span class="nav-number">9.5.3.</span> <span class="nav-text">Atomic\Reference引用类型原子类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#原子化数组"><span class="nav-number">9.5.4.</span> <span class="nav-text">原子化数组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AtomicInteger高并发性能不好"><span class="nav-number">9.5.5.</span> <span class="nav-text">AtomicInteger高并发性能不好</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#LongAdder带来改进和原理"><span class="nav-number">9.5.5.1.</span> <span class="nav-text">LongAdder带来改进和原理</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">徐晋</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">120.9k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>





<div class="BbeiAn-info">
    闽ICP备 -
    <a target="_blank" href="http://www.miitbeian.gov.cn/"   rel="nofollow">19017538号-1</a> <!--a标签中增加nofollow属性，避免爬虫出站。-->| 
  <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=19017538号-1" style="text-decoration:none;padding-left:30px;background:url(https://s1.ax1x.com/2018/09/29/ilmwIH.png) no-repeat left center" rel="nofollow">闽公网安备 19017538号-1</a>    
</div>






        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'fUrgV500Iub9AvoTuhS8YmA3-gzGzoHsz',
        appKey: 'SfEEWyVk3uh3S1oWopriWznO',
        placeholder: 'Just go go',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

    <!-- 代码块复制功能 -->
<script type="text/javascript" src="/js/src/clipboard.min.js"></script>  
<script type="text/javascript" src="/js/src/clipboard-use.js"></script>
</body>
</html>
